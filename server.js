const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

// -------------------------------
// üîπ Warmup-Endpunkt f√ºr UptimeRobot
// -------------------------------
app.get("/warmup", (req, res) => {
    console.log("Warmup-Request ‚Äì Server ist wach.");
    res.send("OK");
});

// Beispiel: Providers
const providers = [
  { name: "Falke", plzs: ["40667","40668","40670","47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47906","47918"], positions: ["S","R","T"] },
  { name: "Prototyp", plzs: ["11111","22222","99999"], positions: ["S","T","R"] },
  { name: "Prototypliegend", plzs: ["11111","22222","99999"], positions: ["L"] },
  { name: "Mobilehilfe", plzs: ["41564","40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","41460","41462","41464","41466","41468","41469","41470","41472","40231","40233"], positions: ["S","R","T"] },
  { name: "Mobilehilfeliegend", plzs: ["41564","40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","41460","41462","41464","41466","41468","41469","41470","41472","40231","40233"], positions: ["L"] },
  { name: "Mobilehilfe2", plzs: ["41564","40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","41460","41462","41464","41466","41468","41469","41470","41472","40231","40233"], positions: ["Smh","Rmh","Tmh"] },
  { name: "Mobilehilfeliegend2", plzs: ["41564","40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","41460","41462","41464","41466","41468","41469","41470","41472","40231","40233"], positions: ["Lmh"] },
  { name: "Rheinherz", plzs: ["40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40231","40233","40235","40237","40239","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","40721","41460","41462","41464","41466","41468","41469","41470","41472","41564"], positions: ["S","R"] },
  { name: "Rheinherz2", plzs: ["40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40231","40233","40235","40237","40239","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","40721","41460","41462","41464","41466","41468","41469","41470","41472","41564"], positions: ["Srh","Rrh"] },
  { name: "Walocare", plzs: ["40215","40217","40219","40221","40223","40225","40227","40229","40231","40233","40235","40237","40239","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40668","40670","40721","41460","41462","41464","41466","41468","41469","41470","41472","41564"], positions: ["S","R"] },
  { name: "1Plus", plzs: ["52062","52064","52066","52068","52070","52072","52074","52076","52078","52080","52134","52146","52152","52156","52159","52222","52223","52224","52249","52477","52499"], positions: ["S","R","T"] },
  { name: "1Plusliegend", plzs: ["52062","52064","52066","52068","52070","52072","52074","52076","52078","52080","52134","52146","52152","52156","52159","52222","52223","52224","52249","52477","52499"], positions: ["L"] },
  { name: "Sequvita", plzs: ["92224","92237","92242","92245","92249","92253","92256","92259","92260","92262","92263","92265","92266","92268","92269","92271","92272","92274","92275","92277","92278","92280","92281","92283","92284","92400","92421","92431","92436","92439","92442","92444","92445","92447","92449","92507","92521","92526","92533","92536","92539","92540","92542","92543","92545","92546","92548","92549","92551","92552","92554","92555","92557","92559","92702","92703","92705","92706","92708","92709","92711","92712","92714","92715","92717","92718","92720","92721","92723","92724","92726","92727","92729","93047","93049","93051","93053","93055","93057","93059","93073","93077","93080","93083","93086","93087","93089","93090","93092","93093","93095","93096","93098","93099","93101","93102","93104","93105","93107","93109","93128","93133","93138","93142","93149","93152","93155","93158","93161","93164","93167","93170","93173","93176","93177","93179","93180","93413","93426","93437","93444","93449","93453","93455","93458","93462","93464","93466","93468","93470","93471","93473","93474","93476","93477","93479","93480","93482","93483","93485","93486","93488"], positions: ["S","R","T"] },
  { name: "Sequvitaliegend", plzs: ["92224","92237","92242","92245","92249","92253","92256","92259","92260","92262","92263","92265","92266","92268","92269","92271","92272","92274","92275","92277","92278","92280","92281","92283","92284","92400","92421","92431","92436","92439","92442","92444","92445","92447","92449","92507","92521","92526","92533","92536","92539","92540","92542","92543","92545","92546","92548","92549","92551","92552","92554","92555","92557","92559","92702","92703","92705","92706","92708","92709","92711","92712","92714","92715","92717","92718","92720","92721","92723","92724","92726","92727","92729","93047","93049","93051","93053","93055","93057","93059","93073","93077","93080","93083","93086","93087","93089","93090","93092","93093","93095","93096","93098","93099","93101","93102","93104","93105","93107","93109","93128","93133","93138","93142","93149","93152","93155","93158","93161","93164","93167","93170","93173","93176","93177","93179","93180","93413","93426","93437","93444","93449","93453","93455","93458","93462","93464","93466","93468","93470","93471","93473","93474","93476","93477","93479","93480","93482","93483","93485","93486","93488"], positions: ["L"] },
  { name: "Tmh", plzs: ["04103","04105","04107","04109","04129","04155","04157","04158","04159","04177","04178","04179","04205","04207","04209","04229","04249","04275","04277","04279","04288","04289","04299","04315","04316","04317","04318","04319","04328","04329","04347","04349","04356","04357","04416","04420","04425","04435","04442","04451","04463","04509","04519","04523","04539","04552","04564","04565","04567","04571","04575","04600","04603","04610","04613","04617","04618","04626","04639","04643","04651","04654","04668","04680","04683","04687","04703","04720","04736","04741","04746","04749","04758","04769","04774","04779","04808","04821","04824","04827","04828","04838","04849","04860","04861","04862","04874","04880","04886","04889","04895","04910","04916","04924","04928","04931","04932","04934","04936","04938","04579","04655"], positions: ["S","R","T"] },
  { name: "Tmhliegend", plzs: ["04103","04105","04107","04109","04129","04155","04157","04158","04159","04177","04178","04179","04205","04207","04209","04229","04249","04275","04277","04279","04288","04289","04299","04315","04316","04317","04318","04319","04328","04329","04347","04349","04356","04357","04416","04420","04425","04435","04442","04451","04463","04509","04519","04523","04539","04552","04564","04565","04567","04571","04575","04600","04603","04610","04613","04617","04618","04626","04639","04643","04651","04654","04668","04680","04683","04687","04703","04720","04736","04741","04746","04749","04758","04769","04774","04779","04808","04821","04824","04827","04828","04838","04849","04860","04861","04862","04874","04880","04886","04889","04895","04910","04916","04924","04928","04931","04932","04934","04936","04938","04579","04655"], positions: ["L"] },
  { name: "Krefeld", plzs: ["47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47906"], positions: ["S","R"] },
  { name: "Krefeld2", plzs: ["47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47906"], positions: ["Sk","Rk"] },
  { name: "Nkb", plzs: ["41061","41063","41065","41079","41066","41169","41334","41366","41372","41379","41747","41748","41749","41751","41836","41844","41849","47669","47804","47877","47906","47918","47929"], positions: ["S","R","T"] },
  { name: "Nkbliegend", plzs: ["41061","41063","41065","41079","41066","41169","41334","41366","41372","41379","41747","41748","41749","41751","41836","41844","41849","47669","47804","47877","47906","47918","47929"], positions: ["L"] },
  { name: "Nkb2", plzs: ["41061","41063","41065","41079","41066","41169","41334","41366","41372","41379","41747","41748","41749","41751","41836","41844","41849","47669","47804","47877","47906","47918","47929"], positions: ["Snkb","Rnkb","Tnkb"] },
  { name: "Nkbliegend2", plzs: ["41061","41063","41065","41079","41066","41169","41334","41366","41372","41379","41747","41748","41749","41751","41836","41844","41849","47669","47804","47877","47906","47918","47929"], positions: ["Lnkb"] },
  { name: "Gotzes", plzs: ["41061","41063","41065","41066","41068","41069","41169","41179","41199","41236","41238","41239","41334","41366","41372","41379","41747","41748","41749","41751","47669","47804","47877","47906","47918","47929"], positions: ["T"] },
  { name: "Gotzesliegend", plzs: ["41061","41063","41065","41066","41068","41069","41169","41179","41199","41236","41238","41239","41334","41366","41372","41379","41747","41748","41749","41751","47669","47804","47877","47906","47918","47929"], positions: ["L"] },
  { name: "Ktm", plzs: ["40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40231","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40667","40668","40670","41068","41069","41199","41236","41238","41239","41352","41363","41460","41462","41464","41466","41468","41469","41470","41472","41515","41516","41517","41539","41540","41541","41542","41564","41747","41748","47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47918"], positions: ["S","R","T"] },
  { name: "Ktmliegend", plzs: ["40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40231","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40667","40668","40670","41068","41069","41199","41236","41238","41239","41352","41363","41460","41462","41464","41466","41468","41469","41470","41472","41515","41516","41517","41539","41540","41541","41542","41564","41747","41748","47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47918"], positions: ["L"] },
  { name: "Ktm2", plzs: ["40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40231","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40667","40668","40670","41068","41069","41199","41236","41238","41239","41352","41363","41460","41462","41464","41466","41468","41469","41470","41472","41515","41516","41517","41539","41540","41541","41542","41564","41747","41748","47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47918"], positions: ["Sktm","Rktm","Tktm"] },
  { name: "Ktmliegend2", plzs: ["40210","40211","40212","40213","40215","40217","40219","40221","40223","40225","40227","40229","40231","40235","40237","40329","40468","40470","40472","40474","40476","40477","40479","40489","40545","40547","40549","40589","40591","40593","40595","40597","40599","40625","40627","40629","40667","40668","40670","41068","41069","41199","41236","41238","41239","41352","41363","41460","41462","41464","41466","41468","41469","41470","41472","41515","41516","41517","41539","41540","41541","41542","41564","41747","41748","47798","47799","47800","47802","47803","47804","47805","47807","47809","47829","47839","47877","47918"], positions: ["Lktm"] },
];

// POST-Route f√ºr Filter
app.post('/filter', (req, res) => {
  const { plz, position } = req.body;

  if (!plz || !position) {
    return res.status(400).json({ error: 'PLZ oder Position fehlt' });
  }

  console.log(`Filter-Abfrage erhalten ‚Üí PLZ: ${plz}, Position: ${position}`);

  const results = providers.filter(p =>
    p.plzs.includes(plz) &&
    p.positions.includes(position)
  );

  console.log("Gefundene Ergebnisse:", results);

  res.json(results);
});

// ------------------------------------
// üöÄ Server starten
// ------------------------------------
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Middleware l√§uft auf Port ${PORT}`));